global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    cluster: 'cdc-replication'
    environment: 'development'

# Rule files for alerting (we'll add these later)
rule_files:
  - '/etc/prometheus/rules/*.yml'

# Scrape configurations
scrape_configs:
  # ============================================
  # Prometheus itself
  # ============================================
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
        labels:
          service: 'prometheus'

  # ============================================
  # Django Application Metrics
  # ============================================
  - job_name: 'django'
    scrape_interval: 10s
    static_configs:
      - targets: ['django:8000']
        labels:
          service: 'django'
          app: 'jovoclient'
    metrics_path: '/metrics'

  # ============================================
  # Celery Workers Metrics (via django-prometheus)
  # ============================================
  - job_name: 'celery-worker'
    scrape_interval: 15s
    static_configs:
      - targets: ['celery-worker:8000']
        labels:
          service: 'celery'
          queue: 'celery'
          worker_type: 'main'

  - job_name: 'celery-consumer'
    scrape_interval: 15s
    static_configs:
      - targets: ['celery-consumer:8000']
        labels:
          service: 'celery'
          queue: 'consumers'
          worker_type: 'consumer'

  # ============================================
  # Redis Exporter (we'll add this in Phase 2)
  # ============================================
  - job_name: 'redis'
    scrape_interval: 15s
    static_configs:
      - targets: ['redis-exporter:9121']
        labels:
          service: 'redis'

  # ============================================
  # MySQL Exporter (we'll add this in Phase 2)
  # ============================================
  - job_name: 'mysql'
    scrape_interval: 30s
    static_configs:
      - targets: ['mysql-exporter:9104']
        labels:
          service: 'mysql'

  # ============================================
  # Kafka JMX Metrics (we'll add this in Phase 2)
  # ============================================
  - job_name: 'kafka-broker-1'
    scrape_interval: 30s
    static_configs:
      - targets: ['kafka-jmx-exporter-1:9308']
        labels:
          service: 'kafka'
          broker_id: '1'

  - job_name: 'kafka-broker-2'
    scrape_interval: 30s
    static_configs:
      - targets: ['kafka-jmx-exporter-2:9308']
        labels:
          service: 'kafka'
          broker_id: '2'

  - job_name: 'kafka-broker-3'
    scrape_interval: 30s
    static_configs:
      - targets: ['kafka-jmx-exporter-3:9308']
        labels:
          service: 'kafka'
          broker_id: '3'

  # ============================================
  # Kafka Connect Metrics
  # ============================================
  - job_name: 'kafka-connect'
    scrape_interval: 30s
    static_configs:
      - targets: ['kafka-connect-jmx-exporter:9308']
        labels:
          service: 'kafka-connect'

  # ============================================
  # Node Exporter (for host machine metrics)
  # ============================================
  - job_name: 'node-exporter'
    scrape_interval: 30s
    static_configs:
      - targets: ['node-exporter:9100']
        labels:
          service: 'node'

  # ============================================
  # cAdvisor (for container metrics)
  # ============================================
  - job_name: 'cadvisor'
    scrape_interval: 15s
    static_configs:
      - targets: ['cadvisor:8080']
        labels:
          service: 'cadvisor'
    metric_relabel_configs:
      # Keep only useful metrics
      - source_labels: [__name__]
        regex: 'container_(cpu|memory|network|fs).*'
        action: keep